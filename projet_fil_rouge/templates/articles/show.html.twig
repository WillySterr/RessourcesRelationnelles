{% extends 'base.html.twig' %}

{% block title %}Articles{% endblock %}

{% block body %}

  <input id="ressource-id" type="hidden" value="{{ ressourceId }}">
 
    <!--Section: Content-->
    <section class="px-md-5 my-5 mx-md-5 dark-grey-text text-center text-lg-left">

      <!--Grid row-->
      <div class="row">

        <!--Grid column-->
        <div class="col-lg-6 mb-4 mb-lg-0 d-flex align-items-center justify-content-center">
          <img width="400" src="{{ asset('/uploads/'~article.photo) }}" class="img-fluid" alt="{{article.titre}}">

        </div>
        <video controls width="400"><source src="{{ asset('/uploads/'~article.video) }}" type="video/mp4"></video>

        <!--Grid column-->

        <!--Grid column-->
        <div class="col-lg-6 mb-4 mb-lg-0 my-5 mx-5text-center">

          <h3 class="font-weight-bold"> Titre de l'article : {{ article.titre}}</h3>

          <p>Sa description : {{ article.description }}</p>
          <div class="d-flex">
          <a class="btn btn-indigo" href="{{ path('articles_index') }}">Retour</a><br/>
          <a class="btn btn-deep-orange" href="{{ path('articles_edit', {'id': article.id}) }}">Modifier</a>
          {{ include('articles/_delete_form.html.twig') }}
          </div>

        </div>
        <!--Grid column-->

      </div>
      <!--Grid row-->

      <form method="POST" action="{{ path('add_comment', {'id': ressourceId}) }}">
        <input class="form-control comments_contenu w-75" name="comments" type="text" placeholder="Saisissez votre commentaire">
      </form>

      <ul id="comments-box" class="comments-list">


{#        {% for comment in comments %}#}
{#          <li class="comment mt-2">#}
{#            <a class="pull-left" href="javascript:void(0);">#}
{#              <img class="avatar rounded-circle" src="https://bootdey.com/img/Content/avatar/avatar1.png" style="width: 5%"alt="avatar">#}
{#            </a>#}
{#            <h5 class="user a">{{ comment.user.firstName }} {{ comment.user.lastName }} a commenté</h5><a href="#"><i class="fas fa-reply ml-2"></i></a>#}
{#            #}{# <p class="time">#}
{#                                            {% if comments.updatedAt is not null %}#}
{#                                                {{ comments.updatedAt|date('Y-m-d H:i:s')  }}#}
{#                                            {% else %}#}
{#                                                {{ comments.createdAt|date('Y-m-d H:i:s')  }}#}
{#                                            {% endif %}#}
{#                                        </p> #}
{#            <div class="comment-body">#}
{#              <div>#}
{#                <p>{{ comment.contenu }}</p>#}
{#              </div>#}
{#            </div>#}
{#          </li>#}

{#        {% endfor %}#}
      </ul>


    </section>
    <!--Section: Content-->
  <script>
    document.addEventListener("DOMContentLoaded", function(event) {

      //On récupère la box dans laquelle on mettra les commentaires

      let commentsBox = document.querySelector('#comments-box');

      //On récupère l'id de la ressource

      let ressourceId = document.querySelector('#ressource-id').value;


      var xhr = new XMLHttpRequest();

      const requestParams = {
          "idRessource" : ressourceId
      }

      //article_comments

      xhr.open('POST', '{{ path('article_comments') }}', true);
      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
      xhr.onreadystatechange = function() { //Appelle une fonction au changement d'état.
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {

          let data = xhr.response;
          loadData(data);
        }
      }
      xhr.responseType = 'json';
      xhr.send(JSON.stringify(requestParams));



      function loadData(data){

        console.log(data)


        for (let i = 0; i < data.length; i++) {
          let eachComment = document.createElement("li");
          eachComment.setAttribute('class', 'comment mt-2')
          eachComment.innerHTML = `<a class="pull-left" href="javascript:void(0);">
              <img class="avatar rounded-circle" src="https://bootdey.com/img/Content/avatar/avatar1.png" style="width: 5%"alt="avatar">
            </a>
            <h5 class="user a">${data[i].user.firstName} ${data[i].user.lastName}  a commenté</h5><a href="#"><i class="fas fa-reply ml-2"></i></a>
             {#<p class="time">#}
             {#                               {% if comments.updatedAt is not null %}#}
             {#                                   {{ comments.updatedAt|date('Y-m-d H:i:s')  }}#}
             {#                               {% else %}#}
             {#                                   {{ comments.createdAt|date('Y-m-d H:i:s')  }}#}
             {#                               {% endif %}#}
             {#                           </p>#}
            <div class="comment-body">
              <div>
                <p>${data[i].contenu}</p>
              </div>
            </div>
          `;

          commentsBox.appendChild(eachComment);
        }
      }

    });


  </script>
  {% block javascript %}{% endblock %}
{% endblock %}

